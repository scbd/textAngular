"use strict";var textAngularVersion="v1.5.16",_browserDetect={ie:function(){for(var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return 4<e?e:void 0}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent),isFirefox:-1<navigator.userAgent.toLowerCase().indexOf("firefox")},performance=performance||{};function stripHtmlToText(e){var t=document.createElement("DIV");t.innerHTML=e;var n=t.textContent||t.innerText||"";return n.replace("â€‹",""),n=n.trim()}function getDomFromHtml(e){var t=document.createElement("DIV");return t.innerHTML=e,t}performance.now=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};var sheet,addCSSRule,removeCSSRule,_addCSSRule,_removeCSSRule,_getRuleIndex,BLOCKELEMENTS=/^(address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,LISTELEMENTS=/^(ul|li|ol)$/i,VALIDELEMENTS=/^(#text|span|address|article|aside|audio|blockquote|canvas|center|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),8<_browserDetect.ie||void 0===_browserDetect.ie){for(var _sheets=document.styleSheets,i=0;i<_sheets.length;i++)try{if((0===_sheets[i].media.length||_sheets[i].media.mediaText.match(/(all|screen)/gi))&&_sheets[i].href&&_sheets[i].href.match(/textangular\.(min\.|)css/gi)){sheet=_sheets[i];break}}catch(e){}sheet||(sheet=function(){var e=document.createElement("style");return _browserDetect.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),addCSSRule=function(e,t){return _addCSSRule(sheet,e,t)},_addCSSRule=function(e,t,n){var a,r;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),sheet.rules?r=sheet.rules[a]:sheet.cssRules&&(r=sheet.cssRules[a]),r},_getRuleIndex=function(e,t){var n,a;for(n=0;n<t.length;n++)if(t[n].cssText===e.cssText){a=n;break}return a},removeCSSRule=function(e){_removeCSSRule(sheet,e)},_removeCSSRule=function(e,t){var n=e.cssRules||e.rules;if(n&&0!==n.length){var a=_getRuleIndex(t,n);e.removeRule?e.removeRule(a):e.deleteRule(a)}}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===_browserDetect.ie?"div":_browserDetect.ie<=8?"P":"p":_browserDetect.ie<=8?e.toUpperCase():e:_browserDetect.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(t,a){return function(e){var n=angular.element("<div></div>");return n[0].innerHTML=e,angular.forEach(t,function(t){var e=[];t.selector&&""!==t.selector?e=n.find(t.selector):t.customAttribute&&""!==t.customAttribute&&(e=a.getByAttribute(n,t.customAttribute)),angular.forEach(e,function(e){e=angular.element(e),t.selector&&""!==t.selector&&t.customAttribute&&""!==t.customAttribute?void 0!==e.attr(t.customAttribute)&&t.renderLogic(e):t.renderLogic(e)})}),n[0].innerHTML}}]).factory("taFixChrome",function(){return function(e,t){if(!e||!angular.isString(e)||e.length<=0)return e;for(var n,a,r,o=/style\s?=\s?(["'])(?:(?=(\\?))\2.)*?\1/gi,l=/<span class="Apple-converted-space">([^<]+)<\/span>/gi,i="",s=0;n=l.exec(e);)r=(r=n[1]).replace(/&nbsp;/gi," "),i+=e.substring(s,n.index)+r,s=n.index+n[0].length;if(s&&(e=i+=e.substring(s),i="",s=0),!t){for(;n=o.exec(e);)i+=e.substring(s,n.index-1),a=n[0],(n=/font-family: inherit;|line-height: 1.[0-9]{3,12};|color: inherit; line-height: 1.1;|color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi.exec(a))?8<(a=a.replace(/( |)font-family: inherit;|( |)line-height: 1.[0-9]{3,12};|( |)color: inherit;|( |)color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);|( |)background-color: rgb\(\d{1,3}, \d{1,3}, \d{1,3}\);/gi,"")).length&&(i+=" "+a):i+=" "+a,s=o.lastIndex;i+=e.substring(s)}return 0<s?i.replace(/<span\s?>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e}}).factory("taSanitize",["$sanitize",function(c){for(var m=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],e=[],t=0;t<m.length;t++){for(var n="("+m[t].property+":\\s*(",a=0;a<m[t].values.length;a++)0<a&&(n+="|"),n+=m[t].values[a];n+=");)",e.push(n)}var g="("+e.join("|")+")";function h(e,t){for(var n,a=0,r=0,o=/<[^>]*>/gi;n=o.exec(e);)if(r=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,r)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(r)}var u=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi),f=new RegExp(/<span class="rangySelectionBoundary" id="selectionBoundary_\d+_\d+">[^<>]+?<\/span>/gi),p=new RegExp(/<span id="selectionBoundary_\d+_\d+" class="rangySelectionBoundary">[^<>]+?<\/span>/gi);return function(e,t,n){if(!n)try{e=function e(t){if(!t||!angular.isString(t)||t.length<=0)return t;for(var n,a,r,o,l,i,s=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,d="",c="",u=0;a=s.exec(t);){o=a[3]||a[4];var f=new RegExp(g,"i");if(angular.isString(o)&&f.test(o)){l="";for(var p=new RegExp(g,"ig");r=p.exec(o);)for(n=0;n<m.length;n++)r[2*n+2]&&(l+="<"+m[n].tag+">");i=e(t.substring(u,a.index)),0<d.length?c+=h(i,d):c+=i,o=o.replace(new RegExp(g,"ig"),""),c+="<"+a[1].trim(),0<o.length&&(c+=' style="'+o+'"'),c+=a[5]+">",u=a.index+a[0].length,d=l}}return 0<d.length?c+=h(t.substring(u),d):c+=t.substring(u),c}(e)}catch(e){}if(e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",r=0;t=n.exec(e);){a+=e.substring(r,t.index),r=t.index+t[0].length;var o="<"+t[1]+t[5];/style=("([^"]+)"|'([^']+)')/gi.test(o)?o=o.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):o+=' style="text-align:'+(t[3]||t[4])+';"',a+=o+=">"}return a+e.substring(r)}(e))try{e=(e=(e=(e=e.replace(u,"")).replace(f,"")).replace(u,"")).replace(p,"")}catch(e){}var a;try{a=c(e),n&&(a=e)}catch(e){a=t||""}var r,o=a.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi),l=a.replace(/(&#(9|10);)*/gi,""),i=/<pre[^>]*>.*?<\/pre[^>]*>/gi,s=0,d=0;for(a="";null!==(r=i.exec(l))&&s<o.length;)a+=l.substring(d,r.index)+o[s],d=r.index+r[0].length,s++;return a+l.substring(d)}}]).factory("taToolExecuteAction",["$q","$log",function(o,l){return function(e){void 0!==e&&(this.$editor=function(){return e});var t,n=o.defer(),a=n.promise,r=this.$editor();try{t=this.action(n,r.startAction()),a.finally(function(){r.endAction.call(r)})}catch(e){l.error(e)}(t||void 0===t)&&n.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(A,D,H){var k=function(e,t){var n,a,r=e.find("li");for(a=r.length-1;0<=a;a--)n=angular.element("<"+t+">"+r[a].innerHTML+"</"+t+">"),e.after(n);e.remove(),A.setSelectionToElementEnd(n[0])},_=function(e,t,n,a,r){var o,l,i,s,d,c=e.find("li");for(l=0;l<c.length;l++)if(c[l].outerHTML===t[0].outerHTML){0<(d=l)&&(i=c[l-1]),l+1<c.length&&(s=c[l+1]);break}var u="";if(a?u+="<"+r+">"+t[0].innerHTML+"</"+r+">":(u+="<"+D(n)+">",u+="<li>"+t[0].innerHTML+"</li>",u+="</"+D(n)+">"),o=angular.element(u),!i)return t.remove(),e.after(angular.element(e[0].outerHTML)),e.after(o),e.remove(),void A.setSelectionToElementEnd(o[0]);if(s){e.parent();var f="",p=e[0].nodeName.toLowerCase();for(f+="<"+p+">",l=0;l<d;l++)f+="<li>"+c[l].innerHTML+"</li>";f+="</"+p+">";var m="";for(m+="<"+p+">",l=d+1;l<c.length;l++)m+="<li>"+c[l].innerHTML+"</li>";m+="</"+p+">",e.after(angular.element(m)),e.after(o),e.after(angular.element(f)),e.remove(),A.setSelectionToElementEnd(o[0])}else t.remove(),e.after(o),A.setSelectionToElementEnd(o[0])},l=function(e){/(<br(|\/)>)$/i.test(e.innerHTML.trim())?A.setSelectionBeforeElement(angular.element(e).find("br")[0]):A.setSelectionToElementEnd(e)},K=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),l(n.find("li")[0])},R=function(e,t,n){for(var a="",r=0;r<e.length;r++)a+="<"+D("li")+">"+e[r].innerHTML+"</"+D("li")+">";var o=angular.element("<"+n+">"+a+"</"+n+">");t.after(o),t.remove(),l(o.find("li")[0])},B=function(e,t){for(var n=0;n<e.childNodes.length;n++){var a=e.childNodes[n];a.tagName&&a.tagName.match(BLOCKELEMENTS)&&B(a,t)}if(null===e.parentNode)return e;if("<br>"===t)return e;var r=angular.element(t);return r[0].innerHTML=e.innerHTML,e.parentNode.insertBefore(r[0],e),e.parentNode.removeChild(e),r};return function(M,$){return M=D(M),function(e,t,n,a){var r,o,l,i,s,d,c,u,f=angular.element("<"+M+">");try{var p,m;A.getSelection&&(u=A.getSelection()),void 0!==(c=A.getSelectionElement()).tagName&&("div"===c.tagName.toLowerCase()&&/taTextElement.+/.test(c.id)&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(p=c.innerHTML,/<br>/i.test(p)&&(p=p.replace(/<br>/i,"&#8203;")),/<br\/>/i.test(p)&&(p=p.replace(/<br\/>/i,"&#8203;")),/<span>(<span>)+/i.test(p)&&(p=__.replace(/<span>(<span>)+/i,"<span>")),/<\/span>(<\/span>)+/i.test(p)&&(p=__.replace(/<\/span>(<\/span>)+/i,"</span>")),/<span><\/span>/i.test(p)&&(p=p.replace(/<span><\/span>/i,"")),m="<div>"+p+"</div>",c.innerHTML=m,A.setSelectionToElementEnd(c.childNodes[0]),c=A.getSelectionElement()):"span"===c.tagName.toLowerCase()&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(p=c.innerHTML,/<br>/i.test(p)&&(p=p.replace(/<br>/i,"&#8203;")),/<br\/>/i.test(p)&&(p=p.replace(/<br\/>/i,"&#8203;")),/<span>(<span>)+/i.test(p)&&(p=__.replace(/<span>(<span>)+/i,"<span>")),/<\/span>(<\/span>)+/i.test(p)&&(p=__.replace(/<\/span>(<\/span>)+/i,"</span>")),/<span><\/span>/i.test(p)&&(p=p.replace(/<span><\/span>/i,"")),m="<div>"+p+"</div>",c.innerHTML=m,A.setSelectionToElementEnd(c.childNodes[0]),c=A.getSelectionElement()):"p"===c.tagName.toLowerCase()&&u&&u.start&&1===u.start.offset&&1===u.end.offset?(p=c.innerHTML,/<br>/i.test(p)&&(p=p.replace(/<br>/i,"&#8203;"),c.innerHTML=p)):"li"===c.tagName.toLowerCase()&&u&&u.start&&u.start.offset===u.end.offset&&(p=c.innerHTML,/<br>/i.test(p)&&(p=p.replace(/<br>/i,""),c.innerHTML=p)))}catch(e){}if(c){var g=angular.element(c),h=c&&c.tagName&&c.tagName.toLowerCase()||"";if("insertorderedlist"===e.toLowerCase()||"insertunorderedlist"===e.toLowerCase()){var v=D("insertorderedlist"===e.toLowerCase()?"ol":"ul"),y=A.getOnlySelectedElements();if(1<y.length&&("ol"===h||"ul"===h))return function(e,t,n,a,r){var o,l,i,s,d,c=e.find("li"),u=[];for(l=0;l<c.length;l++)for(i=0;i<t.length;i++)c[l].isEqualNode(t[i])&&(u[i]=l);0<u[0]&&(s=c[u[0]-1]),u[t.length-1]+1<c.length&&(d=c[u[t.length-1]+1]);var f="";if(a)for(i=0;i<t.length;i++)f+="<"+r+">"+t[i].innerHTML+"</"+r+">",t[i].remove();else{for(f+="<"+D(n)+">",i=0;i<t.length;i++)f+=t[i].outerHTML,t[i].remove();f+="</"+D(n)+">"}if(o=angular.element(f),!s)return e.after(angular.element(e[0].outerHTML)),e.after(o),e.remove(),void A.setSelectionToElementEnd(o[0]);if(!d)return e.after(o),void A.setSelectionToElementEnd(o[0]);var p="",m=e[0].nodeName.toLowerCase();for(p+="<"+m+">",l=0;l<u[0];l++)p+="<li>"+c[l].innerHTML+"</li>";p+="</"+m+">";var g="";for(g+="<"+m+">",l=u[t.length-1]+1;l<c.length;l++)g+="<li>"+c[l].innerHTML+"</li>";g+="</"+m+">",e.after(angular.element(g)),e.after(o),e.after(angular.element(p)),e.remove(),A.setSelectionToElementEnd(o[0])}(g,y,v,v===h,M);if(h===v)return g[0].childNodes.length!==y.length&&1===y.length?(g=angular.element(y[0]),_(g.parent(),g,v,!0,M)):k(g,M);if("li"===h&&g.parent()[0].tagName.toLowerCase()===v&&1===g.parent().children().length)return k(g.parent(),M);if("li"===h&&g.parent()[0].tagName.toLowerCase()!==v&&1===g.parent().children().length)return K(g.parent(),v);if(h.match(BLOCKELEMENTS)&&!g.hasClass("ta-bind")){if(y.length&&g[0].childNodes.length!==y.length&&1===y.length)return g=angular.element(y[0]),_(g.parent(),g,v,v===h,M);if("ol"===h||"ul"===h)return K(g,v);var E=!1;return angular.forEach(g.children(),function(e){e.tagName.match(BLOCKELEMENTS)&&(E=!0)}),R(E?g.children():[angular.element("<div>"+c.innerHTML+"</div>")[0]],g,v)}if(h.match(BLOCKELEMENTS)){if(0===(i=A.getOnlySelectedElements()).length)o=angular.element("<"+v+"><li>"+c.innerHTML+"</li></"+v+">"),g.html(""),g.append(o);else{if(1===i.length&&("ol"===i[0].tagName.toLowerCase()||"ul"===i[0].tagName.toLowerCase()))return i[0].tagName.toLowerCase()===v?k(angular.element(i[0]),M):K(angular.element(i[0]),v);l="";var b=[];for(r=0;r<i.length;r++)if(3!==i[r].nodeType){var x=angular.element(i[r]);if("li"===i[r].tagName.toLowerCase())continue;"ol"===i[r].tagName.toLowerCase()||"ul"===i[r].tagName.toLowerCase()?l+=x[0].innerHTML:"span"!==i[r].tagName.toLowerCase()||"ol"!==i[r].childNodes[0].tagName.toLowerCase()&&"ul"!==i[r].childNodes[0].tagName.toLowerCase()?l+="<"+D("li")+">"+x[0].innerHTML+"</"+D("li")+">":l+=x[0].childNodes[0].innerHTML,b.unshift(x)}o=angular.element("<"+v+">"+l+"</"+v+">"),b.pop().replaceWith(o),angular.forEach(b,function(e){e.remove()})}return void A.setSelectionToElementEnd(o[0])}}else{if("formatblock"===e.toLowerCase()){for("default"===(d=n.toLowerCase().replace(/[<>]/gi,"")).trim()&&(n="<"+(d=M)+">"),o="li"===h?g.parent():g;!o[0].tagName||!o[0].tagName.match(BLOCKELEMENTS)&&!o.parent().attr("contenteditable");)h=((o=o.parent())[0].tagName||"").toLowerCase();if(h===d){i=o.children();var S=!1;for(r=0;r<i.length;r++)S=S||i[r].tagName.match(BLOCKELEMENTS);S?(o.after(i),s=o.next(),o.remove(),o=s):(f.append(o[0].childNodes),o.after(f),o.remove(),o=f)}else if(o.parent()[0].tagName.toLowerCase()!==d||o.parent().hasClass("ta-bind"))if(h.match(LISTELEMENTS))o.wrap(n);else{for(0===(i=A.getOnlySelectedElements()).length&&(i=[o[0]]),r=0;r<i.length;r++)if(3===i[r].nodeType||!i[r].tagName.match(BLOCKELEMENTS))for(;3===i[r].nodeType||!i[r].tagName||!i[r].tagName.match(BLOCKELEMENTS);)i[r]=i[r].parentNode;if(1<(i=i.filter(function(e,t,n){return n.indexOf(e)===t})).length&&(i=i.filter(function(e,t,n){return!("div"===e.nodeName.toLowerCase()&&/^taTextElement/.test(e.id))})),angular.element(i[0]).hasClass("ta-bind"))(o=angular.element(n))[0].innerHTML=i[0].innerHTML,i[0].innerHTML=o[0].outerHTML;else if("blockquote"===d){for(l="",r=0;r<i.length;r++)l+=i[r].outerHTML;for((o=angular.element(n))[0].innerHTML=l,i[0].parentNode.insertBefore(o[0],i[0]),r=i.length-1;0<=r;r--)i[r].parentNode&&i[r].parentNode.removeChild(i[r])}else if("pre"===d&&A.getStateShiftKey()){for(l="",r=0;r<i.length;r++)l+=i[r].outerHTML;for((o=angular.element(n))[0].innerHTML=l,i[0].parentNode.insertBefore(o[0],i[0]),r=i.length-1;0<=r;r--)i[r].parentNode&&i[r].parentNode.removeChild(i[r])}else for(r=0;r<i.length;r++){var T=B(i[r],n);i[r]===o[0]&&(o=angular.element(T))}}else{var w=o.parent(),C=w.contents();for(r=0;r<C.length;r++)w.parent().hasClass("ta-bind")&&3===C[r].nodeType&&((f=angular.element("<"+M+">"))[0].innerHTML=C[r].outerHTML,C[r]=f[0]),w.parent()[0].insertBefore(C[r],w[0]);w.remove()}return A.setSelectionToElementEnd(o[0]),void o[0].focus()}if("createlink"===e.toLowerCase()){if("a"===h)return void(A.getSelectionElement().href=n);var N='<a href="'+n+'" target="'+(a.a.target?a.a.target:"")+'">';if(A.getSelection().collapsed)A.insertHtml(N+n+"</a>",$);else if(rangy.getSelection().getRangeAt(0).canSurroundContents()){var L=angular.element(N+"</a>")[0];rangy.getSelection().getRangeAt(0).surroundContents(L)}return}if("inserthtml"===e.toLowerCase())return void A.insertHtml(n,$)}try{H[0].execCommand(e,t,n)}catch(e){}}}}}]).service("taSelection",["$document","taDOM","$log",function(e,v,t){var n,y=e[0],a=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},E={getSelection:function(){var e;try{e=rangy.getSelection().getRangeAt(0)}catch(e){return}var t=e.commonAncestorContainer,n={start:a(e.startContainer,e.startOffset),end:a(e.endContainer,e.endOffset),collapsed:e.collapsed};return 3===t.nodeType&&("div"===t.parentNode.nodeName.toLowerCase()&&/^taTextElement/.test(t.parentNode.id)||(t=t.parentNode)),"div"===t.nodeName.toLowerCase()&&/^taTextElement/.test(t.id)?(n.start.element=t.childNodes[n.start.offset],n.end.element=t.childNodes[n.end.offset],n.container=t):t.parentNode===n.start.element||t.parentNode===n.end.element?n.container=t.parentNode:n.container=t,n},updateLeftArrowKey:function(e){var t=rangy.getSelection().getRangeAt(0);if(t&&t.collapsed){var n=E.getFlattenedDom(t);if(!n.findIndex)return;var a,r,o=t.startContainer,l=n.findIndex(function(e,t){return e.node===o||-1!==e.parents.indexOf(o)});if(n.forEach(function(e,t){e.parents.forEach(function(e,t){})}),l+1<n.length&&(a=n[l+1].node),a&&a.textContent&&/^\ufeff([^\ufeff]*)$/.exec(a.textContent))return;if(0<l&&(r=n[l-1].node),0===t.startOffset&&r&&/^\ufeff([^\ufeff]*)$/.exec(r.textContent))return void E.setSelectionToElementEnd(r)}},updateRightArrowKey:function(e){},getFlattenedDom:function(e){var t=e.commonAncestorContainer.parentNode;if(!t)return e.commonAncestorContainer.childNodes;var r=Array.prototype.slice.call(t.childNodes),n=r.indexOf(e.startContainer);return n+1<r.length&&0<n||t.parentNode&&(t=t.parentNode),r=[],function n(a){a.node.childNodes.length?Array.prototype.slice.call(a.node.childNodes).forEach(function(e){var t=a.parents.slice();t.slice(-1)[0]!==a.node&&t.push(a.node),n({parents:t,node:e})}):r.push({parents:a.parents,node:a.node})}({parents:[t],node:t}),r},getOnlySelectedElements:function(){var e=rangy.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getAllSelectedElements:function(){var e=rangy.getSelection().getRangeAt(0),t=e.commonAncestorContainer;t=3===t.nodeType?t.parentNode:t;var n=e.getNodes([1],function(e){return e.parentNode===t}),a=t.innerHTML;if((a=a.replace(/<span id=.selectionBoundary[^>]+>\ufeff?<\/span>/gi,""))===e.toHtml()&&("div"!==t.nodeName.toLowerCase()||!/^taTextElement/.test(t.id))){for(var r=[],o=n.length;o--;r.unshift(n[o]));(n=r).push(t)}return n},getSelectionElement:function(){return E.getSelection()?E.getSelection().container:void 0},setSelection:function(e,t,n,a){var r=rangy.createRange();r.setStart(e,n),r.setEnd(t,a),rangy.getSelection().setSingleRange(r)},setSelectionBeforeElement:function(e){var t=rangy.createRange();t.selectNode(e),t.collapse(!0),rangy.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=rangy.createRange();t.selectNode(e),t.collapse(!1),rangy.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=rangy.createRange();t.selectNodeContents(e),t.collapse(!0),rangy.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=rangy.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),rangy.getSelection().setSingleRange(t)},setStateShiftKey:function(e){n=e},getStateShiftKey:function(){return n},insertHtml:function(e,t){var n,a,r,o,l,i,s,d=angular.element("<div>"+e+"</div>"),c=rangy.getSelection().getRangeAt(0),u=y.createDocumentFragment(),f=d[0].childNodes,p=!0;if(0<f.length){for(o=[],r=0;r<f.length;r++){var m=f[r];"p"===m.nodeName.toLowerCase()&&""===m.innerHTML.trim()||(p=p&&!BLOCKELEMENTS.test(m.nodeName),o.push(m))}for(var g=0;g<o.length;g++)i=u.appendChild(o[g]);!p&&c.collapsed&&/^(|<br(|\/)>)$/i.test(c.startContainer.innerHTML)&&c.selectNode(c.startContainer)}else p=!0,i=u=y.createTextNode(e);if(p)c.deleteContents();else if(c.collapsed&&c.startContainer!==t)if(c.startContainer.innerHTML&&c.startContainer.innerHTML.match(/^<[^>]*>$/i))n=c.startContainer,1===c.startOffset?(c.setStartAfter(n),c.setEndAfter(n)):(c.setStartBefore(n),c.setEndBefore(n));else{if(3===c.startContainer.nodeType&&c.startContainer.parentNode!==t)for(a=(n=c.startContainer.parentNode).cloneNode(),v.splitNodes(n.childNodes,n,a,c.startContainer,c.startOffset);!VALIDELEMENTS.test(n.nodeName);){angular.element(n).after(a);var h=a;a=(n=n.parentNode).cloneNode(),v.splitNodes(n.childNodes,n,a,h)}else a=(n=c.startContainer).cloneNode(),v.splitNodes(n.childNodes,n,a,void 0,void 0,c.startOffset);if(angular.element(n).after(a),c.setStartAfter(n),c.setEndAfter(n),/^(|<br(|\/)>)$/i.test(n.innerHTML.trim())&&(c.setStartBefore(n),c.setEndBefore(n),angular.element(n).remove()),/^(|<br(|\/)>)$/i.test(a.innerHTML.trim())&&angular.element(a).remove(),"li"===n.nodeName.toLowerCase()){for(s=y.createDocumentFragment(),l=0;l<u.childNodes.length;l++)d=angular.element("<li>"),v.transferChildNodes(u.childNodes[l],d[0]),v.transferNodeAttributes(u.childNodes[l],d[0]),s.appendChild(d[0]);u=s,i&&(i=(i=u.childNodes[u.childNodes.length-1]).childNodes[i.childNodes.length-1])}}else c.deleteContents();c.insertNode(u),i&&E.setSelectionToElementEnd(i)}};return E}]).service("taDOM",function(){var d={getByAttribute:function(e,t){var n=[],a=e.children();return a.length&&angular.forEach(a,function(e){n=n.concat(d.getByAttribute(angular.element(e),t))}),void 0!==e.attr(t)&&n.push(e),n},transferChildNodes:function(e,t){for(t.innerHTML="";0<e.childNodes.length;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(e,t,n,a,r,o){if(!a&&isNaN(o))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var l=document.createDocumentFragment(),i=document.createDocumentFragment(),s=0;0<e.length&&(isNaN(o)||o!==s)&&e[0]!==a;)l.appendChild(e[0]),s++;for(!isNaN(r)&&0<=r&&e[0]&&(l.appendChild(document.createTextNode(e[0].nodeValue.substring(0,r))),e[0].nodeValue=e[0].nodeValue.substring(r));0<e.length;)i.appendChild(e[0]);d.transferChildNodes(l,t),d.transferChildNodes(i,n)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return d}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var r=parseInt(e.$eval(n.taMaxText));if(isNaN(r))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(r=parseInt(e),isNaN(r))throw"Max text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMaxText=function(e){var t=angular.element("<div/>");return t.html(e),t.text().length<=r}}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var r=parseInt(e.$eval(n.taMinText));if(isNaN(r))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(r=parseInt(e),isNaN(r))throw"Min text must be an integer";a.$dirty&&a.$validate()}),a.$validators.taMinText=function(e){var t=angular.element("<div/>");return t.html(e),!t.text().length||t.text().length>=r}}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){return function(e){return!e||""===stripHtmlToText(e)&&!/<img[^>]+>/.test(e)}}]).directive("taButton",[function(){return{link:function(e,t,n){t.attr("unselectable","on"),t.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1})}}}]).directive("taBind",["taSanitize","$timeout","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM","textAngularManager",function(V,I,F,q,e,U,P,G,X,Y,j,t,J){return{priority:2,require:["ngModel","?ngModelOptions"],link:function(b,x,d,e){var s,S,c,T=e[0],u=e[1]||{},a=void 0!==x.attr("contenteditable")&&x.attr("contenteditable"),t=a||"textarea"===x[0].tagName.toLowerCase()||"input"===x[0].tagName.toLowerCase(),f=!1,n=!1,r=!1,w=d.taUnsafeSanitizer||X.disableSanitizer,o=d.taKeepStyles||X.keepStyles,p=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,m=/^(8|13|32|46|59|61|107|109|173|186|187|188|189|190|191|192|219|220|221|222)$/i,g=[{specialKey:"UndoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:4,mustHaveModifiers:[3,8],keyCode:90},{specialKey:"RedoKey",forbiddenModifiers:12,mustHaveModifiers:[3],keyCode:89},{specialKey:"TabKey",forbiddenModifiers:15,mustHaveModifiers:[],keyCode:9},{specialKey:"ShiftTabKey",forbiddenModifiers:7,mustHaveModifiers:[8],keyCode:9}];void 0===d.taDefaultWrap&&(d.taDefaultWrap="p"),""===d.taDefaultWrap?(c="",void 0===_browserDetect.ie||(11<=_browserDetect.ie||_browserDetect.ie)):(c=void 0===_browserDetect.ie||11<=_browserDetect.ie?"br"===d.taDefaultWrap.toLowerCase()?"<BR><BR>":"<"+d.taDefaultWrap+"><br></"+d.taDefaultWrap+">":_browserDetect.ie<=8?"<"+d.taDefaultWrap.toUpperCase()+"></"+d.taDefaultWrap.toUpperCase()+">":"<"+d.taDefaultWrap+"></"+d.taDefaultWrap+">",void 0===_browserDetect.ie||11<=_browserDetect.ie?"br"===d.taDefaultWrap.toLowerCase()||(d.taDefaultWrap,d.taDefaultWrap):_browserDetect.ie<=8?(d.taDefaultWrap.toUpperCase(),d.taDefaultWrap.toUpperCase()):(d.taDefaultWrap,d.taDefaultWrap)),u.$options||(u.$options={});var h,l=function(e){if(Y(e))return e;var t=angular.element("<div>"+e+"</div>");if(0===t.children().length)e="<"+d.taDefaultWrap+">"+e+"</"+d.taDefaultWrap+">";else{var n,a=t[0].childNodes,r=!1;for(n=0;n<a.length&&!(r=a[n].nodeName.toLowerCase().match(BLOCKELEMENTS));n++);if(r)for(e="",n=0;n<a.length;n++){var o=a[n],l=o.nodeName.toLowerCase();if("#comment"===l)e+="\x3c!--"+o.nodeValue+"--\x3e";else if("#text"===l){var i=o.textContent;i.trim()?e+="<"+d.taDefaultWrap+">"+i+"</"+d.taDefaultWrap+">":e+=i}else if(l.match(BLOCKELEMENTS))e+=o.outerHTML;else{var s=o.outerHTML||o.nodeValue;""!==s.trim()?e+="<"+d.taDefaultWrap+">"+s+"</"+d.taDefaultWrap+">":e+=s}}else e="<"+d.taDefaultWrap+">"+e+"</"+d.taDefaultWrap+">"}return e};d.taPaste&&(S=j(d.taPaste)),x.addClass("ta-bind"),b["$undoManager"+(d.id||"")]=T.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return null==e||void 0!==this.current()&&null!==this.current()&&e===this.current()||(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),h&&I.cancel(h),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1),e},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){if(!(e<0||e>this._stack.length-1))return this._index=e,this.current()},current:function(){return this._stack[this._index]}};var i,C=function(){if(a)return x[0].innerHTML;if(t)return x.val();throw"textAngular Error: attempting to update non-editable taBind"},v=function(e){return b.$emit("ta-element-select",this),e.preventDefault(),!1},y=b["reApplyOnSelectorHandlers"+(d.id||"")]=function(){f||angular.forEach(P,function(e){x.find(e).off("click",v).on("click",v)})},E=function(e,t,n){r=n||!1,null==t&&(t=a),null==e&&(e=C()),Y(e)?(""!==T.$viewValue&&T.$setViewValue(""),t&&""!==T.$undoManager.current()&&T.$undoManager.push("")):(y(),T.$viewValue!==e&&(T.$setViewValue(e),t&&T.$undoManager.push(e))),T.$render()},N=function(e){x[0].innerHTML=e},L=b["$undoTaBind"+(d.id||"")]=function(){if(!f&&a){var e=T.$undoManager.undo();null!=e&&(N(e),E(e,!1),i&&I.cancel(i),i=I(function(){x[0].focus(),U.setSelectionToElementEnd(x[0])},1))}},M=b["$redoTaBind"+(d.id||"")]=function(){if(!f&&a){var e=T.$undoManager.redo();null!=e&&(N(e),E(e,!1),i&&I.cancel(i),i=I(function(){x[0].focus(),U.setSelectionToElementEnd(x[0])},1))}};b["updateTaBind"+(d.id||"")]=function(){f||E(void 0,void 0,!0)};var $=function(e){return T.$oldViewValue=V(q(e,o),T.$oldViewValue,w)};if(x.attr("required")&&(T.$validators.required=function(e,t){return!Y(e||t)}),T.$parsers.push($),T.$parsers.unshift(l),T.$formatters.push($),T.$formatters.unshift(l),T.$formatters.unshift(function(e){return T.$undoManager.push(e||"")}),t)if(b.events={},a){var A,D,H=!1,k=function(e){var t=void 0!==e&&e.match(/content=["']*OneNote.File/i);if(e&&e.trim().length){if(e.match(/class=["']*Mso(Normal|List)/i)||e.match(/content=["']*Word.Document/i)||e.match(/content=["']*OneNote.File/i)){var n=e.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);n=(n=n?n[1]:e).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var a=angular.element("<div>"+n+"</div>"),r=angular.element("<div></div>"),o={element:null,lastIndent:[],lastLi:null,isUl:!1};o.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]};for(var l=function(e){o.isUl=e,o.element=angular.element(e?"<ul>":"<ol>"),o.lastIndent=[],o.lastIndent.peek=function(){var e=this.length;if(0<e)return this[e-1]},o.lastLevelMatch=null},i=0;i<=a[0].childNodes.length;i++)if(a[0].childNodes[i]&&"#text"!==a[0].childNodes[i].nodeName){var s=a[0].childNodes[i].tagName.toLowerCase();if("p"===s||"ul"===s||"h1"===s||"h2"===s||"h3"===s||"h4"===s||"h5"===s||"h6"===s||"table"===s){var d=angular.element(a[0].childNodes[i]),c=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(c){if(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1)continue;var u="bullet"===c[1].toLowerCase()||"number"!==c[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].childNodes[0].innerHTML)),f=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),p=parseFloat(f?f[1]:0),m=(d.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(m&&m[2]&&(p=parseInt(m[2])),m&&(!o.lastLevelMatch||m[1]!==o.lastLevelMatch[1])||!c[3]||"first"===c[3].toLowerCase()||null===o.lastIndent.peek()||o.isUl!==u&&o.lastIndent.peek()===p)l(u),r.append(o.element);else if(null!=o.lastIndent.peek()&&o.lastIndent.peek()<p)o.element=angular.element(u?"<ul>":"<ol>"),o.lastLi.append(o.element);else if(null!=o.lastIndent.peek()&&o.lastIndent.peek()>p){for(;null!=o.lastIndent.peek()&&o.lastIndent.peek()>p;)if("li"!==o.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(o.element.parent()[0].tagName.toLowerCase()))break;o.element=o.element.parent(),o.lastIndent.pop()}else o.element=o.element.parent();o.isUl="ul"===o.element[0].tagName.toLowerCase(),u!==o.isUl&&(l(u),r.append(o.element))}o.lastLevelMatch=m,p!==o.lastIndent.peek()&&o.lastIndent.push(p),o.lastLi=angular.element("<li>"),o.element.append(o.lastLi),o.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}else l(!1),r.append(d)}}var g=function(e){for(var t=(e=angular.element(e))[0].childNodes.length-1;0<=t;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(r.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&g(e)}),angular.forEach(r.find("font"),g),e=r.html(),t&&(e=r.html()||a.html()),e=e.replace(/\n/g," ")}else{if((e=e.replace(/<(|\/)meta[^>]*?>/gi,"")).match(/<[^>]*?(ta-bind)[^>]*?>/)){if(e.match(/<[^>]*?(text-angular)[^>]*?>/)){var h=angular.element("<div>"+e+"</div>");h.find("textarea").remove();for(var v=0;v<binds.length;v++){for(var y=binds[v][0].parentNode.parentNode,E=0;E<binds[v][0].childNodes.length;E++)y.parentNode.insertBefore(binds[v][0].childNodes[E],y);y.parentNode.removeChild(y)}e=h.html().replace('<br class="Apple-interchange-newline">',"")}}else e.match(/^<span/)&&(e.match(/<span class=(\"Apple-converted-space\"|\'Apple-converted-space\')>.<\/span>/gi)||(e=e.replace(/<(|\/)span[^>]*?>/gi,"")));e=e.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}/<li(\s.*)?>/i.test(e)&&!1===/(<ul(\s.*)?>|<ol(\s.*)?>).*<li(\s.*)?>/i.test(e)&&(e=e.replace(/<li(\s.*)?>.*<\/li(\s.*)?>/i,"<ul>$&</ul>")),e=e.replace(/^[ |\u00A0]+/gm,function(e){for(var t="",n=0;n<e.length;n++)t+="&nbsp;";return t}).replace(/\n|\r\n|\r/g,"<br />").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),S&&(e=S(b,{$html:e})||e),e=e.replace(/<span style=("|')([^<]*?)vertical-align\s*:\s*super;?([^>]*?)("|')>([^<]+?)<\/span>/g,"<sup style='$2$3'>$5</sup>"),e=V(e,"",w),U.insertHtml(e,x[0]),I(function(){T.$setViewValue(C()),H=!1,x.removeClass("processing-paste")},0)}else H=!1,x.removeClass("processing-paste")};if(x.on("paste",b.events.paste=function(e,t){if(t&&angular.extend(e,t),f||H)return e.stopPropagation(),e.preventDefault(),!1;var n;H=!0,x.addClass("processing-paste");var a=(e.originalEvent||e).clipboardData;if(!a&&window.clipboardData&&window.clipboardData.getData)return n=window.clipboardData.getData("Text"),k(n),e.stopPropagation(),e.preventDefault(),!1;if(a&&a.getData&&0<a.types.length){for(var r="",o=0;o<a.types.length;o++)r+=" "+a.types[o];return/text\/html/i.test(r)?n=a.getData("text/html"):/text\/plain/i.test(r)&&(n=a.getData("text/plain")),k(n),e.stopPropagation(),e.preventDefault(),!1}var l=rangy.saveSelection(),i=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');F.find("body").append(i),i[0].focus(),I(function(){rangy.restoreSelection(l),k(i[0].innerHTML),x[0].focus(),i.remove()},0)}),x.on("cut",b.events.cut=function(e){f?e.preventDefault():I(function(){T.$setViewValue(C())},0)}),x.on("keydown",b.events.keydown=function(t,e){var n,a,r;if(e&&angular.extend(t,e),16===t.keyCode?U.setStateShiftKey(!0):U.setStateShiftKey(!1),t.specialKey=(n=t,g.forEach(function(e){if(e.keyCode===n.keyCode){var t=(n.metaKey?2:0)+(n.ctrlKey?1:0)+(n.shiftKey?8:0)+(n.altKey?4:0);if(e.forbiddenModifiers&t)return;e.mustHaveModifiers.every(function(e){return t&e})&&(a=e.specialKey)}}),a),X.keyMappings.forEach(function(e){t.specialKey===e.commandKeyCode&&(t.specialKey=void 0),e.testForKey(t)&&(r=e.commandKeyCode),"UndoKey"!==e.commandKeyCode&&"RedoKey"!==e.commandKeyCode||e.enablePropagation||t.preventDefault()}),void 0!==r&&(t.specialKey=r),void 0===t.specialKey||"UndoKey"===t.specialKey&&"RedoKey"===t.specialKey||(t.preventDefault(),J.sendKeyCommand(b,t)),!(f||("UndoKey"===t.specialKey&&(L(),t.preventDefault()),"RedoKey"===t.specialKey&&(M(),t.preventDefault()),13!==t.keyCode||t.shiftKey||t.ctrlKey||t.metaKey||t.altKey))){var o,l=U.getSelectionElement();if(!l.nodeName.match(VALIDELEMENTS))return;var i=angular.element(c);if(function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1}(["blockquote","ul","ol"],l.parentNode.tagName.toLowerCase())){if(/^<br(|\/)>$/i.test(l.innerHTML.trim())&&!l.nextSibling){var s=(o=angular.element(l)).parent();s.after(i),o.remove(),0===s.children().length&&s.remove(),U.setSelectionToElementStart(i[0]),t.preventDefault()}/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(l.innerHTML.trim())&&((o=angular.element(l)).after(i),o.remove(),U.setSelectionToElementStart(i[0]),t.preventDefault())}}}),x.on("keyup",b.events.keyup=function(e,t){if(t&&angular.extend(e,t),U.setStateShiftKey(!1),9!==e.keyCode){if(37!==e.keyCode||e.shiftKey||U.updateLeftArrowKey(x),39!==e.keyCode||e.shiftKey||U.updateRightArrowKey(x),h&&I.cancel(h),!f&&!p.test(e.keyCode))if(13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey));else{if(""!==c&&"<BR><BR>"!==c&&13===e.keyCode&&!e.ctrlKey&&!e.metaKey&&!e.altKey){for(var n=U.getSelectionElement();!n.nodeName.match(VALIDELEMENTS)&&n!==x[0];)n=n.parentNode;if(e.shiftKey){var a=n.tagName.toLowerCase();if((a===d.taDefaultWrap||"li"===a||"pre"===a||"div"===a)&&!/.+<br><br>/.test(n.innerHTML.trim())){var r=n.previousSibling;r&&(r.innerHTML=r.innerHTML+"<br><br>",angular.element(n).remove(),U.setSelectionToElementEnd(r))}}else if(n.tagName.toLowerCase()!==d.taDefaultWrap&&"li"!==n.nodeName.toLowerCase()&&(""===n.innerHTML.trim()||"<br>"===n.innerHTML.trim())){var o=angular.element(c);angular.element(n).replaceWith(o),U.setSelectionToElementStart(o[0])}}var l=C();""===c||""!==l.trim()&&"<br>"!==l.trim()?"<"!==l.substring(0,1)&&d.taDefaultWrap:(N(c),U.setSelectionToElementStart(x.children()[0]));var i=s!==e.keyCode&&m.test(e.keyCode);A&&I.cancel(A),A=I(function(){E(l,i,!0)},u.$options.debounce||400),i||(h=I(function(){T.$undoManager.push(l)},250)),s=e.keyCode}}else U.getSelection().start.element===x[0]&&x.children().length&&U.setSelectionToElementStart(x.children()[0])}),x.on("input",function(){C()!==T.$viewValue&&(D&&I.cancel(D),D=I(function(){var e=rangy.saveSelection(),t=C();t!==T.$viewValue&&E(t,!0),0!==T.$viewValue.length&&rangy.restoreSelection(e)},1e3))}),x.on("blur",b.events.blur=function(){n=!1,f?(r=!0,T.$render()):E(void 0,void 0,!0)}),d.placeholder&&(8<_browserDetect.ie||void 0===_browserDetect.ie)){var _;if(!d.id)throw"textAngular Error: An unique ID is required for placeholders to work";_=addCSSRule("#"+d.id+".placeholder-text:before",'content: "'+d.placeholder+'"'),b.$on("$destroy",function(){removeCSSRule(_)})}x.on("focus",b.events.focus=function(){n=!0,x.removeClass("placeholder-text"),y()}),x.on("mouseup",b.events.mouseup=function(){var e=U.getSelection();e&&e.start.element===x[0]&&x.children().length&&U.setSelectionToElementStart(x.children()[0])}),x.on("mousedown",b.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{x.on("change blur",b.events.change=b.events.blur=function(){f||T.$setViewValue(C())}),x.on("keydown",b.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,r=x.val();if(e.shiftKey){var o=r.lastIndexOf("\n",n),l=r.lastIndexOf("\t",n);-1!==l&&o<=l&&(x.val(r.substring(0,l)+r.substring(l+1)),this.selectionStart=this.selectionEnd=n-1)}else x.val(r.substring(0,n)+"\t"+r.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var K=function(e,t){for(var n="",a=0;a<t;a++)n+=e;return n},R=function(e,t,n){for(var a=0;a<e.length;a++)t.call(n,a,e[a])},B=function(e,a){var r="",t=e.childNodes;return r+=K("\t",++a-1)+e.outerHTML.substring(0,4),R(t,function(e,t){var n=t.nodeName.toLowerCase();"#comment"!==n?"#text"!==n?t.outerHTML&&(r+="ul"===n||"ol"===n?"\n"+B(t,a):"\n"+K("\t",a)+t.outerHTML):r+=t.textContent:r+="\x3c!--"+t.nodeValue+"--\x3e"}),r+="\n"+K("\t",a-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};T.$formatters.unshift(function(a){var e=angular.element("<div>"+a+"</div>")[0].childNodes;return 0<e.length&&(a="",R(e,function(e,t){var n=t.nodeName.toLowerCase();"#comment"!==n?"#text"!==n?t.outerHTML&&(0<a.length&&(a+="\n"),a+="ul"===n||"ol"===n?""+B(t,0):""+t.outerHTML):a+=t.textContent:a+="\x3c!--"+t.nodeValue+"--\x3e"})),a})}var W,z=function(e,t){var n;(t&&angular.extend(e,t),dropFired||f)||(dropFired=!0,n=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,b.$emit("ta-drop-event",this,e,n),I(function(){E(void 0,void 0,!(dropFired=!1))},100))},O=!1;T.$render=function(){if(!O){O=!0;var e=T.$viewValue||"";r||(a&&n&&(x.removeClass("placeholder-text"),W&&I.cancel(W),W=I(function(){n||(x[0].focus(),U.setSelectionToElementEnd(x.children()[x.children().length-1])),W=void 0},1)),a?(d.placeholder,N(""===e?c:e),f?x.off("drop",z):(y(),x.on("drop",z))):"textarea"!==x[0].tagName.toLowerCase()&&"input"!==x[0].tagName.toLowerCase()?N(G(e)):x.val(e)),a&&d.placeholder&&(""===e?n?x.removeClass("placeholder-text"):x.addClass("placeholder-text"):x.removeClass("placeholder-text")),O=r=!1}},d.taReadonly&&((f=b.$eval(d.taReadonly))?(x.addClass("ta-readonly"),"textarea"!==x[0].tagName.toLowerCase()&&"input"!==x[0].tagName.toLowerCase()||x.attr("disabled","disabled"),void 0!==x.attr("contenteditable")&&x.attr("contenteditable")&&x.removeAttr("contenteditable")):(x.removeClass("ta-readonly"),"textarea"===x[0].tagName.toLowerCase()||"input"===x[0].tagName.toLowerCase()?x.removeAttr("disabled"):a&&x.attr("contenteditable","true")),b.$watch(d.taReadonly,function(e,t){t!==e&&(e?(x.addClass("ta-readonly"),"textarea"!==x[0].tagName.toLowerCase()&&"input"!==x[0].tagName.toLowerCase()||x.attr("disabled","disabled"),void 0!==x.attr("contenteditable")&&x.attr("contenteditable")&&x.removeAttr("contenteditable"),angular.forEach(P,function(e){x.find(e).on("click",v)}),x.off("drop",z)):(x.removeClass("ta-readonly"),"textarea"===x[0].tagName.toLowerCase()||"input"===x[0].tagName.toLowerCase()?x.removeAttr("disabled"):a&&x.attr("contenteditable","true"),angular.forEach(P,function(e){x.find(e).off("click",v)}),x.on("drop",z)),f=e)})),a&&!f&&(angular.forEach(P,function(e){x.find(e).on("click",v)}),x.on("drop",z))}}}]);var dropFired=!1,textAngular=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]);textAngular.config([function(){angular.forEach(taTools,function(e,t){delete taTools[t]})}]),textAngular.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$document","$animate","$log","$q","$parse",function(S,T,w,C,N,L,M,$,A,D,H){return{require:"?ngModel",scope:{},restrict:"EA",priority:2,link:function(c,t,u,n){var e,a,r,o,l,i,s,d,f,p,m,g,h=u.serial?u.serial:Math.floor(1e16*Math.random());c._name=u.name?u.name:"textAngularEditor"+h;var v=function(e,t,n){T(function(){e.one(t,n)},100)};if(f=N(u.taDefaultWrap),angular.extend(c,angular.copy(w),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?c["$undoTaBindtaTextElement"+h]():"redo"===e.toLowerCase()?c["$redoTaBindtaTextElement"+h]():(f(e,!1,t,c.defaultTagAttributes),n&&c["reApplyOnSelectorHandlerstaTextElement"+h](),c.displayElements.text[0].focus())},showHtml:c.$eval(u.taShowHtml)||!1}),u.taFocussedClass&&(c.classes.focussed=u.taFocussedClass),u.taTextEditorClass&&(c.classes.textEditor=u.taTextEditorClass),u.taHtmlEditorClass&&(c.classes.htmlEditor=u.taHtmlEditorClass),u.taDefaultTagAttributes)try{angular.extend(c.defaultTagAttributes,angular.fromJson(u.taDefaultTagAttributes))}catch(e){A.error(e)}u.taTextEditorSetup&&(c.setup.textEditorSetup=c.$parent.$eval(u.taTextEditorSetup)),u.taHtmlEditorSetup&&(c.setup.htmlEditorSetup=c.$parent.$eval(u.taHtmlEditorSetup)),u.taFileDrop?c.fileDropHandler=c.$parent.$eval(u.taFileDrop):c.fileDropHandler=c.defaultFileDropHandler,s=t[0].innerHTML,t[0].innerHTML="",c.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},c.displayElements.popover.append(c.displayElements.popoverArrow),c.displayElements.popover.append(c.displayElements.popoverContainer),c.displayElements.scrollWindow.append(c.displayElements.popover),c.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),c.handlePopoverEvents=function(){"block"===c.displayElements.popover.css("display")&&(g&&T.cancel(g),g=T(function(){c.reflowPopover(c.resizeElement),c.reflowResizeOverlay(c.resizeElement)},100))},angular.element(window).on("resize",c.handlePopoverEvents),angular.element(window).on("scroll",c.handlePopoverEvents);c.getScrollTop=function(e,t){var n=e.scrollTop;return void 0===n&&(n=0),t&&function(e){var t,n={vertical:!1,horizontal:!1};try{if(null===(t=window.getComputedStyle(e)))return n}catch(e){return n}var a=t["overflow-y"],r=t["overflow-x"];return{vertical:("scroll"===a||"auto"===a)&&e.scrollHeight>e.clientHeight,horizontal:("scroll"===r||"auto"===r)&&e.scrollWidth>e.clientWidth}}(e).vertical&&(e.removeEventListener("scroll",c._scrollListener,!1),e.addEventListener("scroll",c._scrollListener,!1)),0!==n?{node:e.nodeName,top:n}:e.parentNode?c.getScrollTop(e.parentNode,t):{node:"<none>",top:0}},c.showPopover=function(e){c.getScrollTop(c.displayElements.scrollWindow[0],!0),c.displayElements.popover.css("display","block"),T(function(){c.displayElements.resize.overlay.css("display","block")}),c.resizeElement=e,c.reflowPopover(e),$.addClass(c.displayElements.popover,"in"),v(M.find("body"),"click keyup",function(){c.hidePopover()})},c._scrollListener=function(e,t){c.handlePopoverEvents()},c.reflowPopover=function(e){var t=c.getScrollTop(c.displayElements.scrollWindow[0],!1);e[0].offsetTop-t.top<51?(c.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+c.displayElements.scrollWindow[0].scrollTop+"px"),c.displayElements.popover.removeClass("top").addClass("bottom")):(c.displayElements.popover.css("top",e[0].offsetTop-54+c.displayElements.scrollWindow[0].scrollTop+"px"),c.displayElements.popover.removeClass("bottom").addClass("top"));var n=c.displayElements.text[0].offsetWidth-c.displayElements.popover[0].offsetWidth,a=e[0].offsetLeft+e[0].offsetWidth/2-c.displayElements.popover[0].offsetWidth/2,r=Math.max(0,Math.min(n,a)),o=Math.min(a,Math.max(0,a-n))-11;r+=window.scrollX,o-=window.scrollX,c.displayElements.popover.css("left",r+"px"),c.displayElements.popoverArrow.css("margin-left",o+"px")},c.hidePopover=function(){c.displayElements.popover.css("display","none"),c.displayElements.popoverContainer.attr("style",""),c.displayElements.popoverContainer.attr("class","popover-content"),c.displayElements.popover.removeClass("in"),c.displayElements.resize.overlay.css("display","none")},c.displayElements.resize.overlay.append(c.displayElements.resize.background),angular.forEach(c.displayElements.resize.anchors,function(e){c.displayElements.resize.overlay.append(e)}),c.displayElements.resize.overlay.append(c.displayElements.resize.info),c.displayElements.scrollWindow.append(c.displayElements.resize.overlay),c.displayElements.resize.background.on("click",function(e){c.displayElements.text[0].focus()}),c.reflowResizeOverlay=function(e){e=angular.element(e)[0],c.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),c.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},c.showResizeOverlay=function(d){var n=M.find("body");p=function(e){var i={width:parseInt(d.attr("width")),height:parseInt(d.attr("height")),x:e.clientX,y:e.clientY};(void 0===i.width||isNaN(i.width))&&(i.width=d[0].offsetWidth),(void 0===i.height||isNaN(i.height))&&(i.height=d[0].offsetHeight),c.hidePopover();var s=i.height/i.width,t=function(e){var t={x:Math.max(0,i.width+(e.clientX-i.x)),y:Math.max(0,i.height+(e.clientY-i.y))},n=void 0!==u.taResizeForceAspectRatio,a=u.taResizeMaintainAspectRatio;if(n||a&&!e.shiftKey){var r=t.y/t.x;t.x=r<s?t.x:t.y/s,t.y=r<s?t.x*s:t.y}var o=angular.element(d);function l(e){return Math.round(Math.max(0,e))}o.css("height",l(t.y)+"px"),o.css("width",l(t.x)+"px"),c.reflowResizeOverlay(d)};n.on("mousemove",t),v(n,"mouseup",function(e){e.preventDefault(),e.stopPropagation(),n.off("mousemove",t),c.$apply(function(){c.hidePopover(),c.updateTaBindtaTextElement()},100)}),e.stopPropagation(),e.preventDefault()},c.displayElements.resize.anchors[3].off("mousedown"),c.displayElements.resize.anchors[3].on("mousedown",p),c.reflowResizeOverlay(d),v(n,"click",function(){c.hideResizeOverlay()})},c.hideResizeOverlay=function(){c.displayElements.resize.anchors[3].off("mousedown",p),c.displayElements.resize.overlay.css("display","none")},c.setup.htmlEditorSetup(c.displayElements.html),c.setup.textEditorSetup(c.displayElements.text),c.displayElements.html.attr({id:"taHtmlElement"+h,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),c.displayElements.text.attr({id:"taTextElement"+h,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html","ng-model-options":t.attr("ng-model-options")}),c.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),u.taDefaultWrap&&c.displayElements.text.attr("ta-default-wrap",u.taDefaultWrap),u.taUnsafeSanitizer&&(c.displayElements.text.attr("ta-unsafe-sanitizer",u.taUnsafeSanitizer),c.displayElements.html.attr("ta-unsafe-sanitizer",u.taUnsafeSanitizer)),u.taKeepStyles&&(c.displayElements.text.attr("ta-keep-styles",u.taKeepStyles),c.displayElements.html.attr("ta-keep-styles",u.taKeepStyles)),c.displayElements.scrollWindow.append(c.displayElements.text),t.append(c.displayElements.scrollWindow),t.append(c.displayElements.html),c.displayElements.forminput.attr("name",c._name),t.append(c.displayElements.forminput),u.tabindex&&(t.removeAttr("tabindex"),c.displayElements.text.attr("tabindex",u.tabindex),c.displayElements.html.attr("tabindex",u.tabindex)),u.placeholder&&(c.displayElements.text.attr("placeholder",u.placeholder),c.displayElements.html.attr("placeholder",u.placeholder)),u.taDisabled&&(c.displayElements.text.attr("ta-readonly","disabled"),c.displayElements.html.attr("ta-readonly","disabled"),c.disabled=c.$parent.$eval(u.taDisabled),c.$parent.$watch(u.taDisabled,function(e){c.disabled=e,c.disabled?t.addClass(c.classes.disabled):t.removeClass(c.classes.disabled)})),u.taPaste&&(c._pasteHandler=function(e){return H(u.taPaste)(c.$parent,{$html:e})},c.displayElements.text.attr("ta-paste","_pasteHandler($html)")),S(c.displayElements.scrollWindow)(c),S(c.displayElements.html)(c),c.updateTaBindtaTextElement=c["updateTaBindtaTextElement"+h],c.updateTaBindtaHtmlElement=c["updateTaBindtaHtmlElement"+h],t.addClass("ta-root"),c.displayElements.scrollWindow.addClass("ta-text ta-editor "+c.classes.textEditor),c.displayElements.html.addClass("ta-html ta-editor "+c.classes.htmlEditor);var y=function(e,t){t!==M[0].queryCommandState(e)&&M[0].execCommand(e,!1,null)},E=c._actionRunning=!1;if(c.startAction=function(){var e,t,n,a;return c._actionRunning=!0,e=M[0].queryCommandState("bold"),t=M[0].queryCommandState("italic"),n=M[0].queryCommandState("underline"),a=M[0].queryCommandState("strikeThrough"),E=rangy.saveSelection(),y("bold",e),y("italic",t),y("underline",n),y("strikeThrough",a),function(){E&&rangy.restoreSelection(E)}},c.endAction=function(){c._actionRunning=!1,E&&(c.showHtml?c.displayElements.html[0].focus():c.displayElements.text[0].focus(),rangy.removeMarkers(E)),E=!1,c.updateSelectedStyles(),c.showHtml||c["updateTaBindtaTextElement"+h]()},l=function(e){c.focussed=!0,t.addClass(c.classes.focussed),d.focus(),t.triggerHandler("focus"),c.updateSelectedStyles&&!c._bUpdateSelectedStyles&&T(function(){c.updateSelectedStyles()},0)},c.displayElements.html.on("focus",l),c.displayElements.text.on("focus",l),i=function(e){return c._actionRunning||M[0].activeElement===c.displayElements.html[0]||M[0].activeElement===c.displayElements.text[0]||(t.removeClass(c.classes.focussed),d.unfocus(),T(function(){c._bUpdateSelectedStyles=!1,t.triggerHandler("blur"),c.focussed=!1},0)),e.preventDefault(),!1},c.displayElements.html.on("blur",i),c.displayElements.text.on("blur",i),c.displayElements.text.on("paste",function(e){t.triggerHandler("paste",e)}),c.queryFormatBlockState=function(e){return!c.showHtml&&e.toLowerCase()===M[0].queryCommandValue("formatBlock").toLowerCase()},c.queryCommandState=function(e){return c.showHtml?"":M[0].queryCommandState(e)},c.switchView=function(){c.showHtml=!c.showHtml,$.enabled(!1,c.displayElements.html),$.enabled(!1,c.displayElements.text),c.showHtml?T(function(){return $.enabled(!0,c.displayElements.html),$.enabled(!0,c.displayElements.text),c.displayElements.html[0].focus()},100):T(function(){return $.enabled(!0,c.displayElements.html),$.enabled(!0,c.displayElements.text),c.displayElements.text[0].focus()},100)},u.ngModel){var b=!0;n.$render=function(){if(b){b=!1;var e=c.$parent.$eval(u.ngModel);null==e&&s&&""!==s&&n.$setViewValue(s)}c.displayElements.forminput.val(n.$viewValue),c.html=n.$viewValue||""},t.attr("required")&&(n.$validators.required=function(e,t){var n=e||t;return!(!n||""===n.trim())})}else c.displayElements.forminput.val(s),c.html=s;if(c.$watch("html",function(e,t){e!==t&&(u.ngModel&&n.$viewValue!==e&&n.$setViewValue(e),c.displayElements.forminput.val(e))}),u.taTargetToolbars)d=L.registerEditor(c._name,c,u.taTargetToolbars.split(","));else{var x=angular.element('<div text-angular-toolbar name="textAngularToolbar'+h+'">');u.taToolbar&&x.attr("ta-toolbar",u.taToolbar),u.taToolbarClass&&x.attr("ta-toolbar-class",u.taToolbarClass),u.taToolbarGroupClass&&x.attr("ta-toolbar-group-class",u.taToolbarGroupClass),u.taToolbarButtonClass&&x.attr("ta-toolbar-button-class",u.taToolbarButtonClass),u.taToolbarActiveButtonClass&&x.attr("ta-toolbar-active-button-class",u.taToolbarActiveButtonClass),u.taFocussedClass&&x.attr("ta-focussed-class",u.taFocussedClass),t.prepend(x),S(x)(c.$parent),d=L.registerEditor(c._name,c,["textAngularToolbar"+h])}c.$on("$destroy",function(){L.unregisterEditor(c._name),angular.element(window).off("blur"),angular.element(window).off("resize",c.handlePopoverEvents),angular.element(window).off("scroll",c.handlePopoverEvents)}),c.$on("ta-element-select",function(e,t){d.triggerElementSelect(e,t)&&c["reApplyOnSelectorHandlerstaTextElement"+h]()}),c.$on("ta-drop-event",function(e,t,n,a){a&&a.files&&0<a.files.length?(c.displayElements.text[0].focus(),C.setSelectionToElementEnd(n.target),angular.forEach(a.files,function(e){try{D.when(c.fileDropHandler(e,c.wrapSelection)||c.fileDropHandler!==c.defaultFileDropHandler&&D.when(c.defaultFileDropHandler(e,c.wrapSelection))).then(function(){c["updateTaBindtaTextElement"+h]()})}catch(e){A.error(e)}}),n.preventDefault(),n.stopPropagation()):T(function(){c["updateTaBindtaTextElement"+h]()},0)}),c._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){c._bUpdateSelectedStyles=!1,c.focussed=!1}),c.updateSelectedStyles=function(){var e;m&&T.cancel(m),void 0!==(e=C.getSelectionElement())&&e.parentNode!==c.displayElements.text[0]?d.updateSelectedStyles(angular.element(e)):d.updateSelectedStyles(),c._bUpdateSelectedStyles&&(m=T(c.updateSelectedStyles,200))},e=function(){c.focussed?c._bUpdateSelectedStyles||(c._bUpdateSelectedStyles=!0,c.$apply(function(){c.updateSelectedStyles()})):c._bUpdateSelectedStyles=!1},c.displayElements.html.on("keydown",e),c.displayElements.text.on("keydown",e),a=function(){c._bUpdateSelectedStyles=!1},c.displayElements.html.on("keyup",a),c.displayElements.text.on("keyup",a),r=function(e,t){if(C.getSelection){var n=C.getSelection();C.getSelectionElement()&&"a"===C.getSelectionElement().nodeName.toLowerCase()&&(3===n.start.element.nodeType&&n.start.element.textContent.length===n.end.offset&&C.setSelectionAfterElement(C.getSelectionElement()),3===n.start.element.nodeType&&0===n.start.offset&&C.setSelectionBeforeElement(C.getSelectionElement()))}t&&angular.extend(e,t),c.$apply(function(){if(d.sendKeyCommand(e))return c._bUpdateSelectedStyles||c.updateSelectedStyles(),e.preventDefault(),!1})},c.displayElements.html.on("keypress",r),c.displayElements.text.on("keypress",r),o=function(){c._bUpdateSelectedStyles=!1,T(function(){c.updateSelectedStyles()},0)},c.displayElements.html.on("mouseup",o),c.displayElements.text.on("mouseup",o)}}}]),textAngular.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool","$interval","$rootScope","$log",function(o,p,l,e,t,n){var a,i={},m={},r=0,s=function(t){angular.forEach(m,function(e){e.editorFunctions.updateSelectedStyles(t)})};t.$on("destroy",function(){a&&(e.cancel(a),a=void 0)});var d=function(){50<Math.abs(Date.now()-r)&&(r=Date.now(),a=e(function(){s(),a=void 0},50,1))};return{registerEditor:function(u,f,e){if(!u||""===u)throw"textAngular Error: An editor requires a name";if(!f)throw"textAngular Error: An editor requires a scope";if(m[u])throw'textAngular Error: An Editor with name "'+u+'" already exists';return m[u]={scope:f,toolbars:e,toolbarScopes:[],_registerToolbarScope:function(e){0<=this.toolbars.indexOf(e.name)&&this.toolbarScopes.push(e)},editorFunctions:{disable:function(){angular.forEach(m[u].toolbarScopes,function(e){e.disabled=!0})},enable:function(){angular.forEach(m[u].toolbarScopes,function(e){e.disabled=!1})},focus:function(){angular.forEach(m[u].toolbarScopes,function(e){e._parent=f,e.disabled=!1,e.focussed=!0}),f.focussed=!0},unfocus:function(){angular.forEach(m[u].toolbarScopes,function(e){e.disabled=!0,e.focussed=!1}),f.focussed=!1},updateSelectedStyles:function(n){angular.forEach(m[u].toolbarScopes,function(t){angular.forEach(t.tools,function(e){e.activeState&&(t._parent=f,e.active=e.activeState(n))})})},sendKeyCommand:function(a){var r=!1;return(a.ctrlKey||a.metaKey||a.specialKey)&&angular.forEach(p,function(e,t){if(e.commandKeyCode&&(e.commandKeyCode===a.which||e.commandKeyCode===a.specialKey))for(var n=0;n<m[u].toolbarScopes.length;n++)if(void 0!==m[u].toolbarScopes[n].tools[t]){o.call(m[u].toolbarScopes[n].tools[t],f),r=!0;break}}),r},triggerElementSelect:function(e,n){var a=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},r=[],o={},t=!1;n=angular.element(n);var l=!1;if(angular.forEach(p,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(l=l||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),e.onElementSelect.onlyWithAttrs&&!a(n,e.onElementSelect.onlyWithAttrs)||(o[t]=e))}),l?(angular.forEach(o,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(o,function(e,t){r.push({name:t,tool:e})}),0<r.length)for(var i=0;i<r.length;i++){for(var s=r[i].tool,d=r[i].name,c=0;c<m[u].toolbarScopes.length;c++)if(void 0!==m[u].toolbarScopes[c].tools[d]){s.onElementSelect.action.call(m[u].toolbarScopes[c].tools[d],e,n,f),t=!0;break}if(t)break}return t}}},angular.forEach(e,function(e){i[e]&&m[u].toolbarScopes.push(i[e])}),d(),m[u].editorFunctions},retrieveEditor:function(e){return m[e]},unregisterEditor:function(e){delete m[e],d()},registerToolbar:function(t){if(!t)throw"textAngular Error: A toolbar requires a scope";if(!t.name||""===t.name)throw"textAngular Error: A toolbar requires a name";if(i[t.name])throw'textAngular Error: A toolbar with name "'+t.name+'" already exists';i[t.name]=t,angular.forEach(m,function(e){e._registerToolbarScope(t)}),d()},retrieveToolbar:function(e){return i[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete i[e],d()},updateToolsDisplay:function(e){var n=this;angular.forEach(e,function(e,t){n.updateToolDisplay(t,e)})},resetToolsDisplay:function(){var n=this;angular.forEach(p,function(e,t){n.resetToolDisplay(t)}),d()},updateToolDisplay:function(n,a){var r=this;angular.forEach(i,function(e,t){r.updateToolbarToolDisplay(t,n,a)}),d()},resetToolDisplay:function(n){var a=this;angular.forEach(i,function(e,t){a.resetToolbarToolDisplay(t,n)}),d()},updateToolbarToolDisplay:function(e,t,n){if(!i[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';i[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,t){if(!i[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';i[e].updateToolDisplay(t,p[t],!0)},removeTool:function(r){delete p[r],angular.forEach(i,function(e){delete e.tools[r];for(var t=0;t<e.toolbar.length;t++){for(var n,a=0;a<e.toolbar[t].length;a++){if(e.toolbar[t][a]===r){n={group:t,index:a};break}if(void 0!==n)break}void 0!==n&&(e.toolbar[n.group].slice(n.index,1),e._$element.children().eq(n.group).children().eq(n.index).remove())}}),d()},addTool:function(t,n,a,r){l(t,n),angular.forEach(i,function(e){e.addTool(t,n,a,r)}),d()},addToolToToolbar:function(e,t,n,a,r){l(e,t),i[n].addTool(e,t,a,r),d()},refreshEditor:function(e){if(!m[e])throw'textAngular Error: No Editor with name "'+e+'" exists';m[e].scope.updateTaBindtaTextElement(),m[e].scope.$$phase||m[e].scope.$digest(),d()},sendKeyCommand:function(e,t){var n=m[e._name];if(n&&n.editorFunctions.sendKeyCommand(t))return e._bUpdateSelectedStyles||e.updateSelectedStyles(),t.preventDefault(),!1},updateStyles:s,getVersion:function(){return textAngularVersion},getToolbarScopes:function(){var t=[];return angular.forEach(m,function(e){t=t.concat(e.toolbarScopes)}),t}}}]),textAngular.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(d,t,n,c,a,r){return{scope:{name:"@"},restrict:"EA",link:function(o,l,e){if(!o.name||""===o.name)throw"textAngular Error: A toolbar requires a name";angular.extend(o,angular.copy(n)),e.taToolbar&&(o.toolbar=o.$parent.$eval(e.taToolbar)),e.taToolbarClass&&(o.classes.toolbar=e.taToolbarClass),e.taToolbarGroupClass&&(o.classes.toolbarGroup=e.taToolbarGroupClass),e.taToolbarButtonClass&&(o.classes.toolbarButton=e.taToolbarButtonClass),e.taToolbarActiveButtonClass&&(o.classes.toolbarButtonActive=e.taToolbarActiveButtonClass),e.taFocussedClass&&(o.classes.focussed=e.taFocussedClass),o.disabled=!0,o.focussed=!1,(o._$element=l)[0].innerHTML="",l.addClass("ta-toolbar "+o.classes.toolbar),o.$watch("focussed",function(){o.focussed?l.addClass(o.classes.focussed):l.removeClass(o.classes.focussed)});var i=function(e,t){var n;if(n=e&&e.display?angular.element(e.display):angular.element("<button type='button'>"),e&&e.class?n.addClass(e.class):n.addClass(o.classes.toolbarButton),n.attr("name",t.name),n.attr("ta-button","ta-button"),n.attr("ng-disabled","isDisabled()"),n.attr("tabindex","-1"),n.attr("ng-click","executeAction()"),n.attr("ng-class","displayActiveToolClass(active)"),e&&e.tooltiptext&&n.attr("title",e.tooltiptext),e&&!e.display&&!t._display&&(n[0].innerHTML="",e.buttontext&&(n[0].innerHTML=e.buttontext),e.iconclass)){var a=angular.element("<i>"),r=n[0].innerHTML;a.addClass(e.iconclass),n[0].innerHTML="",n.append(a),r&&""!==r&&n.append("&nbsp;"+r)}return t._lastToolDefinition=angular.copy(e),d(n)(t)};o.tools={},o._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var s={$window:r,$editor:function(){return o._parent},isDisabled:function(){return("html"!==this.name||!o._parent.startAction)&&("function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled)},displayActiveToolClass:function(e){return e?o.classes.toolbarButtonActive:""},executeAction:a};angular.forEach(o.toolbar,function(e){var t=angular.element("<div>");t.addClass(o.classes.toolbarGroup),angular.forEach(e,function(e){o.tools[e]=angular.extend(o.$new(!0),c[e],s,{name:e}),o.tools[e].$element=i(c[e],o.tools[e]),t.append(o.tools[e].$element)}),l.append(t)}),o.updateToolDisplay=function(e,t,n){var a=o.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var r=i(t,a);a.$element.replaceWith(r),a.$element=r}},o.addTool=function(e,t,n,a){var r;o.tools[e]=angular.extend(o.$new(!0),c[e],s,{name:e}),o.tools[e].$element=i(c[e],o.tools[e]),void 0===n&&(n=o.toolbar.length-1),r=angular.element(l.children()[n]),void 0===a?(r.append(o.tools[e].$element),o.toolbar[n][o.toolbar[n].length-1]=e):(r.children().eq(a).after(o.tools[e].$element),o.toolbar[n][a]=e)},t.registerToolbar(o),o.$on("$destroy",function(){t.unregisterToolbar(o.name)})}}}]),textAngular.directive("textAngularVersion",["textAngularManager",function(e){var a=e.getVersion();return{restrict:"EA",link:function(e,t,n){t.html(a)}}}]);
